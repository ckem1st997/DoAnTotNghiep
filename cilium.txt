chú ý====================
cài bằng cli
cilium install --version 1.14.9
update các biến có thể bằng helm chart
    elm upgrade cilium cilium/cilium --version 1.14.9 \
  --namespace kube-system \
  --reuse-values \
  --set kubeProxyReplacement=true

helm upgrade cilium cilium/cilium --version 1.14.9 \
    --namespace kube-system \
    --reuse-values \
    --set ingressController.enabled=true \
    --set ingressController.loadbalancerMode=dedicated
kubectl -n kube-system rollout restart deployment/cilium-operator
kubectl -n kube-system rollout restart ds/cilium













rancher-ui

=== thêm chứng chỉ và rancher ui chart values
helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
kubectl create namespace cattle-system
# If you have installed the CRDs manually instead of with the `--set installCRDs=true` option added to your Helm install command, you should upgrade your CRD resources before upgrading the Helm chart:
kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.7.1/cert-manager.crds.yaml
# Add the Jetstack Helm repository
helm repo add jetstack https://charts.jetstack.io
# Update your local Helm chart repository cache
helm repo update
# Install the cert-manager Helm chart
helm install cert-manager jetstack/cert-manager \
  --namespace cert-manager \
  --create-namespace \
  --version v1.7.1


=== cài đặt rancher với domain
helm repo add rancher-stable https://releases.rancher.com/server-charts/stable

  helm install rancher rancher-stable/rancher \
  --namespace cattle-system \
  --set hostname=hopnk.xyz \
  --set replicas=1 \
  --set bootstrapPassword=6HjhRwfdsfds43







curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC='--flannel-backend=none --disable-network-policy' sh -
rm -r ~/.kube/config
export KUBECONFIG=/etc/rancher/k3s/k3s.yaml
  cilium install --version 1.14.9


export PATH=$PATH:/var/lib/rancher/rke2/bin



export KUBECONFIG=/etc/rancher/rke2/rke2.yaml


cài rke2 theo doc
tạo và cấu hình trong fil config.yaml /etc/rancher/rke2

tạo file cấu hình cilium trong var/lib/rancher/rke2/server 


systemctl restart rke2-server.service


===config.yaml
#/etc/rancher/rke2/config.yaml
#cluster-cidr: "10.42.0.0/16,2001:cafe:42::/56" cilium tu dong
#service-cidr: "10.43.0.0/16,2001:cafe:43::/112" ciliun tu dong
disable-kube-proxy: true
network:
  plugin: none
cni: none  # tự cài bằng cli


rke2-cilium-config.yaml
# /var/lib/rancher/rke2/server/manifests/rke2-cilium-config.yaml
---
apiVersion: helm.cattle.io/v1
kind: HelmChartConfig
metadata:
  name: rke2-cilium
  namespace: kube-system
spec:
  chart: https://helm.cilium.io/cilium
  version: 1.14.9
  valuesContent: |-
    eni:
      enabled: true
    kubeProxyReplacement: true
    k8sServiceHost: 127.0.0.1
    k8sServicePort: 6443
    hubble:
      enabled: true
      relay:
        enabled: true
      ui:
        enabled: true




















Để thiết lập biến môi trường KUBECONFIG một cách vĩnh viễn trên hệ điều hành Linux hoặc macOS, bạn cần thêm dòng export vào file cấu hình shell của mình. Dưới đây là hướng dẫn cho hai shell phổ biến nhất: Bash và Zsh.

Đối với Bash (mặc định trên nhiều hệ điều hành Linux và macOS cũ hơn)
Mở Terminal.

Mở file cấu hình Bash của bạn bằng một trình soạn thảo văn bản. Nếu bạn đang sử dụng Linux, file này thường là .bashrc trong thư mục home của bạn. Trên macOS, file này có thể là .bash_profile hoặc .profile. Sử dụng lệnh sau để mở file (thay nano bằng trình soạn thảo bạn thích, ví dụ: vi, emacs,...):

bash
Copy code
nano ~/.bashrc  # Trên Linux
nano ~/.bash_profile  # Trên macOS
Thêm dòng sau vào cuối file:

bash
Copy code
export KUBECONFIG=/path/to/your/kubeconfig/file
Thay /path/to/your/kubeconfig/file bằng đường dẫn thực tế đến file kubeconfig của bạn.

Lưu và đóng trình soạn thảo. Trong nano, bạn có thể làm điều này bằng cách nhấn Ctrl+O, Enter để lưu và Ctrl+X để thoát.

Áp dụng thay đổi cho phiên hiện tại của terminal bằng cách chạy:

bash
Copy code
source ~/.bashrc  # Trên Linux
source ~/.bash_profile  # Trên macOS
Đối với Zsh (mặc định trên macOS từ Catalina trở đi)
Mở Terminal.

Mở file cấu hình Zsh của bạn bằng một trình soạn thảo văn bản:

zsh
Copy code
nano ~/.zshrc
Thêm dòng sau vào cuối file:

zsh
Copy code
export KUBECONFIG=/path/to/your/kubeconfig/file
Như trên, thay thế /path/to/your/kubeconfig/file bằng đường dẫn thực tế của bạn.

Lưu và đóng trình soạn thảo. Trong nano, bạn có thể làm điều này bằng cách nhấn Ctrl+O, Enter để lưu và Ctrl+X để thoát.

Áp dụng thay đổi cho phiên hiện tại của terminal bằng cách chạy:

zsh
Copy code
source ~/.zshrc
Bây giờ, mỗi khi bạn mở một terminal mới, biến môi trường KUBECONFIG sẽ tự động được thiết lập, và kubectl sẽ sử dụng file kubeconfig mà bạn đã chỉ định để kết nối với cluster Kubernetes của mình. Điều này giúp bạn không cần phải export biến KUBECONFIG mỗi lần mở một terminal mới.
